<!doctype html>
<!--
 Copyright (c) 2022 Google LLC All rights reserved.
 Use of this source code is governed by a BSD-style
 license that can be found in the LICENSE file.
-->


<button onclick="send()">Send</button>
<br>
<br>
<hr>

<div>
  <input id="url" style="width: 80%;" value="./test.html">
</div>
<br>

<iframe id="iframe"></iframe>
<br><br>

<button onclick="load()">Load</button><button onclick="upload()">Upload</button>
<br><br>

<div id="cons"></div>

<script type="module">
  import {subscribe} from './client.js';
  const onmessage = msg => {
    cons.innerHTML += msg + '<hr>';
  };
  subscribe(onmessage);
  window.send = () => {
    fetch(`http://behelits.com:3000/publish/?msg=googoogoo`);
  };
  window.load = () => {
    iframe.src = url.value;
  };
  window.upload = async () => {
    const content = await fetch(url.value);
    const text = await content.text();
    fetch(`http://behelits.com:3000/publish/?msg=${encodeURI(text)}`);
  };
</script>